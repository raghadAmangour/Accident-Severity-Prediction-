# -*- coding: utf-8 -*-
"""Automobile Accident Severity Prediction.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1u-UlbxiQSM_0IQhk1y17M7BIVhSNj1vm

ุชูุงูุ ูุดุฑูุน ุชุนูููู ุงูุขูุฉ ุนูู ุจูุงูุงุช **US Accidents** ููุฑุฉ ุฑุงุฆุนุฉ ููููุฏุฉ ุฌุฏูุง! ๐ช

ุฃูุง ุฌุงูุฒ ุฃุณุงุนุฏู ุฎุทูุฉ ุฎุทูุฉ ูู ุงูุจุฏุงูุฉ ููููุงูุฉ. ุฎูููุง ูุจุฏุฃ ุจุงูุชุฎุทูุท ุงูุนุงู ูููุดุฑูุนุ ูุจุนุฏูุง ูุจุฏุฃ ุงูุชูููุฐ ูุนูุง.

---

## ุฎุทุฉ ูุดุฑูุน ุชุนูููู ุงูุขูุฉ ุนูู ุจูุงูุงุช US Accidents

### 1. **ููู ุงูุจูุงูุงุช ูุงุณุชูุดุงููุง (Exploratory Data Analysis - EDA)**

* ูุฑุงุกุฉ ุงูุจูุงูุงุช
* ููู ุงูุฃุนูุฏุฉ ูุฃููุงุนูุง
* ุงูุชุนุงูู ูุน ุงูููู ุงูููููุฏุฉ
* ุชุญููู ุฅุญุตุงุฆู ููุจูุงูุงุช (ูุตููุฉ)
* ุฑุณู ุจุนุถ ุงูุฑุณูู ุงูุจูุงููุฉ ููุชูุฒูุนุงุช ูุงูุนูุงูุงุช

### 2. **ุชุญุถูุฑ ุงูุจูุงูุงุช (Data Preprocessing)**

* ุชูุธูู ุงูุจูุงูุงุช (ุญุฐู ุฃู ุชุนููุถ ุงูููู ุงููุงุฑุบุฉ)
* ุชุญููู ุงูุจูุงูุงุช ุงููุตูุฉ ุฅูู ุฃุฑูุงู (Encoding)
* ุฅูุดุงุก ููุฒุงุช ุฌุฏูุฏุฉ (Feature Engineering)
* ุชูููู ุญุฌู ุงูุจูุงูุงุช (ูู ูุจูุฑ ุฌุฏูุง) ููุงุฎุชุจุงุฑ

### 3. **ุงุฎุชูุงุฑ ูุฏู ุงููุดุฑูุน (Target Variable)**

* ูุซูุงู: ุงูุชูุจุค ุจุดุฏุฉ ุงูุญุงุฏุซ (`Severity`) ุจูุงุกู ุนูู ุงูุนูุงูู ุงูุฃุฎุฑู

### 4. **ุชูุณูู ุงูุจูุงูุงุช (Train/Test Split)**

* ุชูุณูู ุงูุจูุงูุงุช ุฅูู ูุฌููุนุงุช ุชุฏุฑูุจ ูุงุฎุชุจุงุฑ

### 5. **ุงุฎุชูุงุฑ ูููุฐุฌ ุชุนูููู ุงูุขูุฉ (Model Selection)**

* ูุซูุงู: ุงูุงูุญุฏุงุฑ ุงูููุฌุณุชูุ ุดุฌุฑุฉ ุงููุฑุงุฑุ ุงูุบุงุจุงุช ุงูุนุดูุงุฆูุฉุ XGBoost...

### 6. **ุชุฏุฑูุจ ุงููููุฐุฌ (Model Training)**

* ุชุฏุฑูุจ ุงููููุฐุฌ ุนูู ุจูุงูุงุช ุงูุชุฏุฑูุจ

### 7. **ุชูููู ุงููููุฐุฌ (Model Evaluation)**

* ุงุณุชุฎุฏุงู ููุงููุณ ููุงุณุจุฉ (ูุซู ุงูุฏูุฉ Accuracyุ F1-scoreุ recallุ precision)
* ุงุฎุชุจุงุฑ ุงููููุฐุฌ ุนูู ุจูุงูุงุช ุงูุงุฎุชุจุงุฑ

### 8. **ุชุญุณูู ุงููููุฐุฌ (Model Tuning)**

* ุถุจุท ุงููุนุงููุงุช (Hyperparameter tuning)
* ุชุญุณูู ุงูุฃุฏุงุก

### 9. **ุงููุดุฑ ุฃู ุงูุงุณุชุฎุฏุงู ุงูุนููู**

* ุญูุธ ุงููููุฐุฌ
* ุนูู ุชูุจุคุงุช ุนูู ุจูุงูุงุช ุฌุฏูุฏุฉ

---

## ูู ุชูุงูู ุนูู ูุฐู ุงูุฎุทุฉุ

ูู ุชุญุจุ ูุจุฏุฃ ููุฑูุง ุจุงูุฎุทูุฉ ุงูุฃููู: **ูุฑุงุกุฉ ุงูุจูุงูุงุช ูุนุฑุถ ุจุนุถ ุงููุนูููุงุช ุงูุฃุณุงุณูุฉุ**

ุฅุฐุง ูุนูุ ุฃุฑุณู ูู ููุทุ ูุฃูุง ุฃุฌูุฒ ูู ููุฏ Python ูุดุฑุญ ููู ุฎุทูุฉ!
"""

from google.colab import files
files.upload()  # ุงุฎุชุฑ ููู kaggle.json ูู ุฌูุงุฒู

!pip install -q kaggle
!mkdir -p ~/.kaggle
!cp kaggle.json ~/.kaggle/
!chmod 600 ~/.kaggle/kaggle.json

!kaggle datasets download -d sobhanmoosavi/us-accidents
!unzip -q us-accidents.zip

!pip install tensorflow

import numpy as np
import pandas as pd

from sklearn.preprocessing import StandardScaler
from sklearn.model_selection import train_test_split

import tensorflow as tf

import pandas as pd

data = pd.read_csv('US_Accidents_March23.csv', nrows=400000)

data

print(data.head())

data.info()

data.describe()

"""## Data Cleaning & Preprocessing

###Missing Values
"""

data.isna().mean()

missing_ratio = data.isna().mean() # ุณูุนุฑุถ ูุณุจุฉ ุงูููู ุงููุงูุตุฉ ููุท ููุฃุนูุฏุฉ ุงูุชู ูููุง ููู ูุงูุตุฉุ ูุฑุชุจุฉ ุชูุงุฒูููุง.
print(missing_ratio[missing_ratio > 0].sort_values(ascending=False))

missing = data.isna().sum()
missing = missing[missing > 0]  # ููุท ุงูุฃุนูุฏุฉ ุงูุชู ุชุญุชูู ุนูู ููู ูุงูุตุฉ
print(missing)

#ุงูุทุฑููุฉ ุงูุจุณูุทุฉ ููุนุฑูุฉ ุงูุฃุนูุฏุฉ ุงูุชู ุชุญุชูู ุนูู ููู ูุงูุตุฉ:
#ููุฑุฌุน ุนุฏุฏ ุงูููู ุงููุงูุตุฉ ูู ูู ุนููุฏ.

#ุฃู ุนููุฏ ูููู ูู ูููุฉ ุฃูุจุฑ ูู 0 โ ูุนูู ูุญุชูู ุนูู ููู ูุงูุตุฉ.

data.isna().sum()

'Number' in data.columns

null_columns = ['End_Lat', 'End_Lng', 'Wind_Chill(F)', 'Precipitation(in)']

data = data.drop(null_columns, axis=1)

data.isna().sum()

data = data.dropna(axis=0).reset_index(drop=True)

"""| ุงูุฌุฒุก                     | ูุงุฐุง ููุนูุ                                                                                         |
| ------------------------- | -------------------------------------------------------------------------------------------------- |
| `data.dropna(axis=0)`     | ูุญุฐู ุฃู **ุตู** ูุญุชูู ุนูู ูููุฉ ูุงูุตุฉ (`NaN`).<br> `axis=0` ุชุนูู ุงูุตููู.                             |
| `.reset_index(drop=True)` | ูุนูุฏ ุชุฑููู ุงูุตููู ูู ุฌุฏูุฏ ุจุนุฏ ุงูุญุฐูุ<br> `drop=True` ูุนูู ุนุฏู ุงูุงุญุชูุงุธ ุจุงูููุฑุณ ุงููุฏูู ูุนููุฏ ุฅุถุงูู. |
| `data = ...`              | ููุนูุฏ ุชุฎุฒูู ุงููุชูุฌุฉ ูู ููุณ ูุชุบูุฑ `data` (ุฃู ููุญุฏูุซ ุงูุจูุงูุงุช).                                      |

ูุซุงู ูุจุณุท:
ูู ุนูุฏู ุฌุฏูู ุจูุงูุงุช ูุซู:

| Name  | Age | City   |
| ----- | --- | ------ |
| Ali   | 25  | Riyadh |
| Sarah | NaN | Jeddah |
| Ahmed | 30  | NaN    |

ุจุนุฏ ุชุดุบูู:

python
Copy
Edit
data = data.dropna(axis=0).reset_index(drop=True)
ุงููุชูุฌุฉ ุณุชููู:

| Name | Age | City   |
| ---- | --- | ------ |
| Ali  | 25  | Riyadh |


ุงูุตูุงู ุงูุซุงูู ูุงูุซุงูุซ ุชู ุญุฐููููุง ูุฃู ููููุง ููู ูุงูุตุฉ.

ุงูููุฑุณุฉ ุชู ุฅุนุงุฏุฉ ุถุจุทูุง (0ุ 1ุ 2...)

โ๏ธ ููุงุญุธุฉ ูููุฉ:


ูุฐุง ุงูุณุทุฑ ูุญุฐู ุงูุตู ุจุงููุงูู ุญุชู ูู ูุงูุช ุงููููุฉ ุงููุงูุตุฉ ูู ุนููุฏ ูุงุญุฏ ููุท.

ูุฐุง ูุฌุจ ุงุณุชุฎุฏุงูู ููุท ุจุนุฏ ุงูุชุฃูุฏ ุฃูู ูุง ุชุญุชุงุฌ ุชูู ุงูุตููู ุฃู ุงูุฃุนูุฏุฉ.
"""

print("Total missing values:", data.isna().sum().sum())

"""๐ ูุงุฐุง ููุนู ูุฐุง ุงูุณุทุฑุ
ูู ูููู ุจุทุจุงุนุฉ ุงูุนุฏุฏ ุงูุฅุฌูุงูู ูุฌููุน ุงูููู ุงููุงูุตุฉ (missing values) ูู ูุงูู ุฌุฏูู ุงูุจูุงูุงุช data.

| ุงูุฌุฒุก           | ูุงุฐุง ููุนูุ                                                                                         |
| --------------- | -------------------------------------------------------------------------------------------------- |
| `data.isna()`   | ููุฑุฌุน ุฌุฏูู ุจููุณ ุดูู `data` ููู ุงูููู ููู ุชููู `True` ุฅุฐุง ูุงูุช `NaN`ุ ู `False` ุฅุฐุง ูุงูุช ุบูุฑ ูุงูุตุฉ. |
| `.sum()`        | ูุฌูุน ุนุฏุฏ ุงูููู ุงููุงูุตุฉ **ูู ูู ุนููุฏ** (ูุฃู `True` = 1 ู `False` = 0 ูู ุจุงูุซูู).                    |
| `.sum()` ุงูุซุงูู | ูุฌูุน ูู ูุชุงุฆุฌ ุงูุฃุนูุฏุฉ ูุนูุงุ ููุนุทูู **ุงูุนุฏุฏ ุงูููู ููููู ุงููุงูุตุฉ** ูู ูุงูู ุงูุฌุฏูู.                   |
| `print(...)`    | ูุทุจุน ุงููุชูุฌุฉ ุนูู ุงูุดุงุดุฉ ูุน ุงููุต ุงูุชูุถูุญู `"Total missing values:"`.                                |
"""

data

import matplotlib.pyplot as plt
import seaborn as sns
sns.countplot(x='Severity', data=data)
plt.title('Distribution of Accident Severity')
plt.xlabel('Severity')
plt.ylabel('Count')
plt.show()

numerical_cols = data.select_dtypes(include=['float64', 'int64']).columns

for col in numerical_cols:
    plt.figure(figsize=(6, 3))
    sns.histplot(data[col], kde=True, bins=30)
    plt.title(f'Distribution of {col}')
    plt.show()

plt.figure(figsize=(10, 5))
sns.boxplot(x='Severity', y='Distance(mi)', data=data)
plt.title('Distance vs Severity')
plt.show()

#plt.figure(figsize=(12, 10))
#sns.heatmap(data.corr(), annot=False, cmap='coolwarm')
#plt.title('Correlation Heatmap')
#plt.show()

"""#Unnecessary Columns"""

{column: len(data[column].unique()) for column in data.columns if data.dtypes[column] == 'object'}

"""ุงููุฏู:
ุฅูุดุงุก ูุงููุณ (dictionary) ูุญุชูู ุนูู:

ุงุณู ูู ุนููุฏ ูุตู (object)

ูุนุฏุฏ ุงูููู ุงููุฑูุฏุฉ (unique values) ูู ูุฐุง ุงูุนููุฏ

| ุงูุฌุฒุก                                | ุงูุดุฑุญ                                                                               |
| ------------------------------------ | ----------------------------------------------------------------------------------- |
| `for column in data.columns`         | ุญููุฉ ุชูุฑ ุนูู ูู ุนููุฏ ูู ุฌุฏูู ุงูุจูุงูุงุช                                               |
| `if data.dtypes[column] == 'object'` | ุดุฑุท: ููุท ุงูุฃุนูุฏุฉ ุงูุชู ููุน ุจูุงูุงุชูุง ูุตูุฉ (`object`)                                  |
| `data[column].unique()`              | ุชูุฑุฌุน ุฌููุน ุงูููู ุงููุฑูุฏุฉ (ุงููุฎุชููุฉ) ูู ูุฐุง ุงูุนููุฏ                                   |
| `len(...)`                           | ูุญุณุงุจ ุนุฏุฏ ูุฐู ุงูููู ุงููุฑูุฏุฉ                                                         |
| `{column: len(...)} `                | ูุจูู ุฒูุฌ ููุชุงุญ ููููุฉ ูู ุงููุงููุณุ ุงูููุชุงุญ ูู ุงุณู ุงูุนููุฏ ูุงููููุฉ ูู ุนุฏุฏ ุงูููู ุงููุฑูุฏุฉ |

ูุซุงู ูุจุณุท:
ุงูุชุฑุถ ุฃู ุนูุฏู ุฌุฏูู ุจูุงูุงุช ูุงูุชุงูู:

| City   | Weather |
| ------ | ------- |
| Riyadh | Sunny   |
| Jeddah | Cloudy  |
| Riyadh | Sunny   |
| Dammam | Rain    |

ุงูููุฏ ุณูููุชุฌ:

{
  'City': 3,           # Riyadh, Jeddah, Dammam
  'Weather': 3         # Sunny, Cloudy, Rain
}

๐๏ธ ููุงุฐุง ูุฐุง ูููุฏุ
ูุณุงุนุฏู ุชุนุฑู ุงูุฃุนูุฏุฉ ุงููุตูุฉ ูุนุฏุฏ ุงููุฆุงุช (ุงููููุงุช) ุงูููุฌูุฏุฉ ูููุง.

ููู ุฌุฏูุง ูุจู ุฃู ุชุฑููุฒ (Encoding)ุ ูุซู LabelEncoder ุฃู OneHotEncoder.

ุฅุฐุง ูุงู ุนุฏุฏ ุงูููู ุงููุฑูุฏุฉ ูุจูุฑ ุฌุฏูุงุ ุฑุจูุง ูุง ููุงุณุจ ูููุฐุฌู.
"""

unneeded_columns = ['ID', 'Description', 'Street', 'City', 'Zipcode', 'Country']

data = data.drop(unneeded_columns, axis=1)

"""๐ฏ ุงููุฏู:
ุญุฐู ุงูุฃุนูุฏุฉ ุบูุฑ ุงููููุฏุฉ (ุฃู ุบูุฑ ุงูุถุฑูุฑูุฉ) ูู ุจูุงูุงุชู ูุจู ุงูุชุฏุฑูุจ ุนูู ูููุฐุฌ ุงูุชุนูู ุงูุขูู.

๐ ุดุฑุญ ุณุจุจ ุญุฐู ูู ุนููุฏ:

| ุงูุนููุฏ        | ุงูุณุจุจ ุงููุญุชูู ูุญุฐูู                                        |
| ------------- | ---------------------------------------------------------- |
| `ID`          | ุฑูู ุชุนุฑูู ูุฑูุฏ ูุง ููููุฏ ุงููููุฐุฌ.                           |
| `Description` | ูุต ุทููู ุฌุฏูุงุ ูุฏ ูุญุชุงุฌ ูุนุงูุฌุฉ ูุบููุฉ ูุนูุฏุฉ (NLP).           |
| `Street`      | ุชูุงุตูู ุฏูููุฉ ุฌุฏูุงุ ูุฏ ูุง ุชุถูู ูุงุฆุฏุฉ ุชุญููููุฉ.               |
| `City`        | ุนุฏุฏ ุงููุฏู ูุจูุฑ ุฌุฏูุง โ ุชุฑููุฒูุง ุตุนุจ ุฃู ุบูุฑ ูุนูุงู.            |
| `Zipcode`     | ุบุงูุจูุง ูุดุงุจู ูููููุน ุงูุฌุบุฑุงูู ุงูููุฌูุฏ ูู ุฃุนูุฏุฉ ุฃุฎุฑู.        |
| `Country`     | ูููุง "US" ุชูุฑูุจูุง ูู ูุฐู ุงูุจูุงูุงุชุ ููุง ุชุถูู ูุนูููุงุช ุฌุฏูุฏุฉ. |

๐งช ูุซุงู ูุตุบุฑ:
ูู ูุงู ูุฏูู ุฌุฏูู ูุซู ูุฐุง:

| ID   | Description     | City    | Severity |
| ---- | --------------- | ------- | -------- |
| A001 | Accident on I-5 | Seattle | 3        |
| A002 | Crash on 101    | LA      | 2        |

ุจุนุฏ ุงูุญุฐู:

| Severity |
| -------- |
| 3        |
| 2        |



(ูู ูุงู ููุงู ุฃุนูุฏุฉ ุฃุฎุฑู ูุซู Severity ุฃู Start_Lat ููู ุชุจููุ ููุท ุงูุฃุนูุฏุฉ ุบูุฑ ุงููููุฏุฉ ุชูุญุฐู.)
"""

data

def get_years(df, column):
    return df[column].apply(lambda date: date[0:4])

def get_months(df, column):
    return df[column].apply(lambda date: date[5:7])

"""๐ฏ ุงููุฏู:
ุงุณุชุฎุฑุงุฌ ุงูุณูุฉ ูุงูุดูุฑ ูู ุนููุฏ ูุญุชูู ุนูู ุชูุงุฑูุฎ (ูุซู Start_Time ุฃู End_Time) ูุชุฎุฒูููุง ูู ุฃุนูุฏุฉ ุฌุฏูุฏุฉ.

๐ง ุดุฑุญ ุชูุตููู:
๐ฆ ุงูุฏุงูุฉ get_years(df, column)

| ุงูุฌุฒุก                      | ุงููุนูู                                                                                                |
| -------------------------- | ----------------------------------------------------------------------------------------------------- |
| `def get_years(...)`       | ุชุนุฑูู ุฏุงูุฉ ุงุณููุง `get_years`                                                                          |
| `df[column]`               | ุงููุตูู ุฅูู ุนููุฏ ูู ุฌุฏูู ุงูุจูุงูุงุช                                                                      |
| `.apply(lambda date: ...)` | ุชุทุจูู ุฏุงูุฉ ููู ุตู (ููู ุชุงุฑูุฎ)                                                                         |
| `date[0:4]`                | ุชูุทุน ุฃูู 4 ุฃุญุฑู ูู ุงูุชุงุฑูุฎ โ ููู ุงูุฌุฒุก ุงูุฎุงุต ุจุงูุณูุฉ (ูุซูุงู `"2019"` ุฅุฐุง ุงูุชุงุฑูุฎ `"2019-05-01 14:00"`) |
| **ุงููุชูุฌุฉ**                | ุนููุฏ ุฌุฏูุฏ ูุญุชูู ุนูู ุงูุณูุฉ ููุท ูู ูู ุชุงุฑูุฎ.                                                            |

๐ฆ ุงูุฏุงูุฉ get_months(df, column)
ูุซู ุงูุณุงุจูุฉุ ููููุง ุชุฃุฎุฐ ุงูุฃุญุฑู ูู ุงูููุถุน 5 ุฅูู 7 โ ููู ุชูุซู ุงูุดูุฑ.

'2020-11-18 08:00:00'[5:7]  โ  '11'

โ๏ธ ููุงุญุธุฉ ูููุฉ:
ูุฐู ุงูุฏูุงู ุชูุชุฑุถ ุฃู ุงูุชุงุฑูุฎ ูู ููุน ูุตู (string)ุ ูููุณ ูู ููุน datetime.

ุฅุฐุง ูุงู ุงูุนููุฏ ูู ููุน datetime64, ุงูุฃูุถู ุงุณุชุฎุฏุงู:

df['Start_Time'].dt.year

df['Start_Time'].dt.month

๐งช ูุซุงู ุนููู:
ุฅุฐุง ุนูุฏู:


df['Start_Time'] = ['2020-05-01 08:00:00', '2019-11-15 14:30:00']

ูููุช ุจุชุทุจูู:


df['Start_Year'] = get_years(df, 'Start_Time')

df['Start_Month'] = get_months(df, 'Start_Time')

ุงููุชูุฌุฉ:

| Start\_Time         | Start\_Year | Start\_Month |
| ------------------- | ----------- | ------------ |
| 2020-05-01 08:00:00 | 2020        | 05           |
| 2019-11-15 14:30:00 | 2019        | 11           |
"""

data['Start_Time_Month'] = get_months(data, 'Start_Time')
data['Start_Time_Year'] = get_years(data, 'Start_Time')

data['End_Time_Month'] = get_months(data, 'End_Time')
data['End_Time_Year'] = get_years(data, 'End_Time')

data['Weather_Timestamp_Month'] = get_months(data, 'Weather_Timestamp')
data['Weather_Timestamp_Year'] = get_years(data, 'Weather_Timestamp')


data = data.drop(['Start_Time', 'End_Time', 'Weather_Timestamp'], axis=1)

"""ุฃููุฏ! ูุฐุง ุงูููุฏ ููุถุญ ุฎุทูุฉ ูููุฉ ูู ูุนุงูุฌุฉ ุงูุจูุงูุงุช ูุฎุงุตุฉ ุงุณุชุฎุฑุงุฌ ุฃุฌุฒุงุก ูู ุงูุชูุงุฑูุฎ ุซู ุญุฐู ุงูุฃุนูุฏุฉ ุงูุฃุตููุฉ. ุฏุนูู ุฃุดุฑุญ ูู ูู ุฎุทูุฉ:

ุดุฑุญ ูู ุฌุฒุก:
1. ุงุณุชุฎุฑุงุฌ ุงูุดูุฑ ูุงูุณูุฉ ูู ุนููุฏ Start_Time:
python
Copy
Edit
data['Start_Time_Month'] = get_months(data, 'Start_Time')
data['Start_Time_Year'] = get_years(data, 'Start_Time')
get_months: ุชุณุชุฎุฑุฌ ุงูุดูุฑ (ูุซูุงู: "01" ุฅูู "12") ูู ุชุงุฑูุฎ ุจุฏุงูุฉ ุงูุญุงุฏุซ.

get_years: ุชุณุชุฎุฑุฌ ุงูุณูุฉ (ูุซูุงู: "2019" ุฃู "2020") ูู ุชุงุฑูุฎ ุจุฏุงูุฉ ุงูุญุงุฏุซ.

ุงููุชูุฌุฉ: ุนููุฏุงู ุฌุฏูุฏุงู Start_Time_Month ู Start_Time_Year ูุญุชููุงู ุนูู ููู ุดูุฑ ูุณูุฉ ูู ุญุงุฏุซ.

2. ุงุณุชุฎุฑุงุฌ ุงูุดูุฑ ูุงูุณูุฉ ูู ุนููุฏ End_Time:

data['End_Time_Month'] = get_months(data, 'End_Time')

data['End_Time_Year'] = get_years(data, 'End_Time')

ููุณ ุงูุฎุทูุฉ ููู ูุชุงุฑูุฎ ููุงูุฉ ุงูุญุงุฏุซ.

3. ุงุณุชุฎุฑุงุฌ ุงูุดูุฑ ูุงูุณูุฉ ูู ุนููุฏ Weather_Timestamp:

data['Weather_Timestamp_Month'] = get_months(data, 'Weather_Timestamp')

data['Weather_Timestamp_Year'] = get_years(data, 'Weather_Timestamp')

ุชุณุชุฎุฑุฌ ุงูุดูุฑ ูุงูุณูุฉ ูู ุชูููุช ุงูุทูุณ ุงููุณุฌู.

4. ุญุฐู ุงูุฃุนูุฏุฉ ุงูุฃุตููุฉ ููุชุงุฑูุฎ:

data = data.drop(['Start_Time', 'End_Time', 'Weather_Timestamp'], axis=1)

ุจุนุฏ ุงุณุชุฎุฑุงุฌ ุงูุณูุฉ ูุงูุดูุฑ ูู ุงูุชูุงุฑูุฎุ ูู ูุนุฏ ุจุญุงุฌุฉ ููุฃุนูุฏุฉ ุงูุฃุตููุฉ.


ูุญุฐููุง ูุชูููู ุงูุชุนููุฏ ูุญุฌู ุงูุจูุงูุงุช.

axis=1 ุชุนูู ุญุฐู ุฃุนูุฏุฉ.

๐ง ููุงุฐุง ููุนู ูุฐุงุ
ููุงุฐุฌ ุงูุชุนูู ุงูุขูู ุบุงูุจูุง ูุง ุชููู ุงูุชูุงุฑูุฎ ุงููุตูุฉ ุฃู ุงููุนูุฏุฉ.

ุจุชูุณูู ุงูุชุงุฑูุฎ ุฅูู ุณูุฉ ูุดูุฑุ ูุนุทู ุงููููุฐุฌ ูุนูููุงุช ููุธูุฉ ูุฃุณูู ููููู.

ุญุฐู ุงูุฃุนูุฏุฉ ุงูุฃุตููุฉ ูููู ูู ุงูุถูุถุงุก ูููุณุฑุน ุนูููุฉ ุงูุชุฏุฑูุจ.
"""

data

"""#Encoding"""

def onehot_encode(df, columns, prefixes):
    df = df.copy()
    for column, prefix in zip(columns, prefixes):
        dummies = pd.get_dummies(df[column], prefix=prefix)
        df = pd.concat([df, dummies], axis=1)
        df = df.drop(column, axis=1)
    return df

"""ุฃููุฏ! ูุฐุง ุงูููุฏ ูุนุฑูู ุฏุงูุฉ ููููุฉ ุฌุฏูุง ูู ูุฑุญูุฉ ุชุฌููุฒ ุงูุจูุงูุงุช ููููุงุฐุฌุ ููู ุงูุชุฑููุฒ ุงูุฃุญุงุฏู (One-Hot Encoding).
ุฏุนูู ุฃุดุฑุญ ูู ุฎุทูุฉ ุจุฎุทูุฉ:

๐ฏ ุงููุฏู ูู ุงูุฏุงูุฉ:

ุชุญููู ุงูุฃุนูุฏุฉ ุงูุชู ุชุญุชูู ุนูู ุจูุงูุงุช ูุฆููุฉ (Categorical) ูุซู "Day", "Weather", "State" ุฅูู ุฃุนูุฏุฉ ุฑูููุฉ ุจุงุณุชุฎุฏุงู ุชูููุฉ One-Hot Encoding.

๐ง ุดุฑุญ ูู ุฌุฒุก:


| ุงูุณุทุฑ                                           | ุงูุดุฑุญ                                                                                                                                                                                                                      |
| ----------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `def onehot_encode(df, columns, prefixes):`     | ุชุนุฑูู ุฏุงูุฉ ุงุณููุง `onehot_encode` ุชุฃุฎุฐ 3 ูุฏุฎูุงุช: <br>1. `df`: ุฌุฏูู ุงูุจูุงูุงุช <br>2. `columns`: ูุงุฆูุฉ ุจุฃุณูุงุก ุงูุฃุนูุฏุฉ ุงูุชู ุชุฑูุฏ ุชุฑููุฒูุง <br>3. `prefixes`: ูุงุฆูุฉ ุจููุณ ุงูุทูู ุชูุณุชุฎุฏู ูุชุณููุฉ ุงูุฃุนูุฏุฉ ุงูุฌุฏูุฏุฉ ุงููุงุชุฌุฉ ุนู ุงูุชุฑููุฒ. |
| `df = df.copy()`                                | ุฅูุดุงุก ูุณุฎุฉ ูู DataFrame ุงูุฃุตูู ูุชุฌูุจ ุชุนุฏูู ุงูุจูุงูุงุช ุงูุฃุตููุฉ ูุจุงุดุฑุฉ.                                                                                                                                                        |
| `for column, prefix in zip(columns, prefixes):` | ุญููุฉ ุชูุฑ ุนูู ูู ุนููุฏ ูุน ุงูุจุงุฏุฆุฉ ุงูุฎุงุตุฉ ุจูุ ุจุงุณุชุฎุฏุงู `zip()` ูุฑุจุท ุงูุนููุฏ ูุน ุงูุจุงุฏุฆุฉ ุงูููุงุณุจุฉ.                                                                                                                               |
| `pd.get_dummies(df[column], prefix=prefix)`     | ูุฐู ุงูุฏุงูุฉ ูู pandas ุชููู ุจู **one-hot encoding**: <br>ุชุญููู ูู ูุฆุฉ ุฏุงุฎู ุงูุนููุฏ ุฅูู **ุนููุฏ ุฌุฏูุฏ ูุญุชูู ุนูู 0 ุฃู 1**.                                                                                                        |
| `pd.concat([df, dummies], axis=1)`              | ุฏูุฌ ุงูุฃุนูุฏุฉ ุงูุฌุฏูุฏุฉ ุงููุงุชุฌุฉ ุนู ุงูุชุฑููุฒ (`dummies`) ูุน DataFrame ุงูุฃุตูู.                                                                                                                                                    |
| `df = df.drop(column, axis=1)`                  | ุญุฐู ุงูุนููุฏ ุงูุฃุตูู ุจุนุฏ ุชุญูููู ุฅูู ุฃุนูุฏุฉ ุฑูููุฉ.                                                                                                                                                                              |
| `return df`                                     | ุชูุฑุฌุน ูุณุฎุฉ ุฌุฏูุฏุฉ ูู DataFrame ุจุนุฏ ุงูุชุฑููุฒ.                                                                                                                                                                                 |

๐งช ูุซุงู ุนููู:
ูู ุนูุฏู DataFrame ูุซู:

| Color |
| ----- |
| Red   |
| Blue  |
| Red   |
| Green |

ูููุช ุจุชุทุจูู:

python
Copy
Edit
onehot_encode(df, ['Color'], ['Color'])

ุงููุชูุฌุฉ ุณุชููู:

| Color\_Blue | Color\_Green | Color\_Red |
| ----------- | ------------ | ---------- |
| 0           | 0            | 1          |
| 1           | 0            | 0          |
| 0           | 0            | 1          |
| 0           | 1            | 0          |

โ ููุงุฐุง ูุณุชุฎุฏู One-Hot Encodingุ
ูุฃู ุฎูุงุฑุฒููุงุช ุงูุชุนูู ุงูุขูู ูุง ุชููู ุงูููู ุงููุตูุฉ.

ุชุญููููุง ุฅูู ุฃุฑูุงู ูุฌุนู ุงููููุฐุฌ ูุงุฏุฑูุง ุนูู ุงูุชุนุงูู ูุนูุง ุจุดูู ุตุญูุญ.

One-hot ูู ุงูุฃูุซุฑ ุงุณุชุฎุฏุงููุง ูุน ุงูุจูุงูุงุช ุงููุฆููุฉ ุบูุฑ ุงููุฑุชุจุฉ (ูุซู ุงููุฏููุฉุ ุงูุญุงูุฉ ุงูุฌููุฉ...).
"""

{column: len(data[column].unique()) for column in data.columns if data.dtypes[column] == 'object'}

data = onehot_encode(
    data,
    columns=['County', 'State', 'Timezone', 'Airport_Code', 'Wind_Direction', 'Weather_Condition'],
    prefixes=['SI', 'CO', 'ST', 'TZ', 'AC', 'WD', 'WC']
)

data

def get_binary_column(df, column):
    if column == 'Source':
        return df[column].apply(lambda x: 1 if x == 'MapQuest' else 0)
    else:
        return df[column].apply(lambda x: 1 if x == 'Day' else 0)

"""ููุชุงุฒ! ูุฐุง ุงูููุฏ ูุนุฑูู ุฏุงูุฉ ุงุณููุง get_binary_columnุ ููู ุชูุณุชุฎุฏู ูุชุญููู ุนููุฏ ูุฆูู (Categorical column) ุฅูู ุนููุฏ ุซูุงุฆู (Binary column) โ ุฃู ูุญุชูู ููุท ุนูู 1 ุฃู 0.

๐ฏ ุงููุฏู:
ุชุญููู ุนููุฏ ูุฆูู ุฅูู ุนููุฏ ุซูุงุฆู (binary) ุจุงุณุชุฎุฏุงู ูุงุนุฏุฉ ูุญุฏุฏุฉ:

ุฅุฐุง ูุงู ุงูุนููุฏ ูู 'Source'ุ ุณูุชู ุชุฑููุฒู ูู:

1 ุฅุฐุง ูุงูุช ุงููููุฉ 'MapQuest'

0 ุฅุฐุง ูุงูุช ุฃู ุดูุก ุขุฎุฑ

ุฃูุง ุฅุฐุง ูุงู ุงูุนููุฏ ููุณ 'Source' (ูุนูู ุฃู ุนููุฏ ุขุฎุฑ)ุ ุณูุชู ุชุฑููุฒู ูู:

1 ุฅุฐุง ูุงูุช ุงููููุฉ 'Day'

0 ุฅุฐุง ูุงูุช ุฃู ุดูุก ุขุฎุฑ

๐ง ุดุฑุญ ุชูุตููู ููู ุฌุฒุก:

| ุงูุณุทุฑ                                                            | ุงูุดุฑุญ                                                                                        |
| ---------------------------------------------------------------- | -------------------------------------------------------------------------------------------- |
| `def get_binary_column(df, column):`                             | ุชุนุฑูู ุฏุงูุฉ ุงุณููุง `get_binary_column` ุชุฃุฎุฐ:<br>1๏ธโฃ DataFrame `df`ุ<br>2๏ธโฃ ุงุณู ุงูุนููุฏ `column` |
| `if column == 'Source':`                                         | ุชุญูู ููุง ุฅุฐุง ูุงู ุงูุนููุฏ ูู `'Source'`                                                        |
| `return df[column].apply(lambda x: 1 if x == 'MapQuest' else 0)` | ุฅุฐุง ูุงู ุงูุนููุฏ ูู `'Source'`ุ ูุญููู ุงูููู ุฅูู `1` ุฅุฐุง ูุงูุช `'MapQuest'`ุ ุฃู `0` ุบูุฑ ุฐูู      |
| `else:`                                                          | ุฅุฐุง ูุงู ุงูุนููุฏ ููุณ `'Source'`                                                                |
| `return df[column].apply(lambda x: 1 if x == 'Day' else 0)`      | ุญููู ุงูููู ุฅูู `1` ุฅุฐุง ูุงูุช `'Day'`ุ ุฃู `0` ุบูุฑ ุฐูู                                          |

๐งช ูุซุงู ุนููู:

ุฅุฐุง ูุงูุช ุงูุจูุงูุงุช:

df = pd.DataFrame({'Source': ['MapQuest', 'Bing', 'MapQuest', 'Here']})


ูููุช ุจุชุทุจูู:


df['Source_binary'] = get_binary_column(df, 'Source')

ุณุชุญุตู ุนูู:

| Source   | Source\_binary |
| -------- | -------------- |
| MapQuest | 1              |
| Bing     | 0              |
| MapQuest | 1              |
| Here     | 0              |

ูุซุงู ุขุฎุฑ:

df = pd.DataFrame({'Sunrise_Sunset': ['Day', 'Night', 'Day', 'Night']})

df['Daytime'] = get_binary_column(df, 'Sunrise_Sunset')

ุงููุชูุฌุฉ:

| Sunrise\_Sunset | Daytime |
| --------------- | ------- |
| Day             | 1       |
| Night           | 0       |
| Day             | 1       |
| Night           | 0       |

โ ููุงุฐุง ูุณุชุฎุฏู ูุฐุง ุงูููุน ูู ุงูุชุฑููุฒุ
ูุฃูู ูููุฏ ุนูุฏ ูุฌูุฏ ูููุชูู ููุท (binary category).

ูุจุณุท ุงูุจูุงูุงุช ูุฌุนููุง ููุงุณุจุฉ ูููุงุฐุฌ ุงูุชุนูู ุงูุขูู.
"""

data['Source'] = get_binary_column(data, 'Source')

data['Sunrise_Sunset'] = get_binary_column(data, 'Sunrise_Sunset')
data['Civil_Twilight'] = get_binary_column(data, 'Civil_Twilight')
data['Nautical_Twilight'] = get_binary_column(data, 'Nautical_Twilight')
data['Astronomical_Twilight'] = get_binary_column(data, 'Astronomical_Twilight')

"""ุฑุงุฆุน! ๐ฏ ูุฐุง ุงูููุฏ ููุทุจู ุงูุฏุงูุฉ get_binary_column() ุงูุชู ุดุฑุญูุงูุง ุณุงุจููุง ุนูู ุนุฏุฉ ุฃุนูุฏุฉ ูู ุงูุจูุงูุงุช ูุชุญููููุง ุฅูู ููู ุซูุงุฆูุฉ (0 ุฃู 1).

ุฏุนูู ุฃุดุฑุญ ูู ุณุทุฑูุง ุจุณุทุฑ:

data['Source'] = get_binary_column(data, 'Source')


โค ูุงุฐุง ููุนูุ

ูุญููู ุนููุฏ 'Source' ุฅูู ุนููุฏ ุฌุฏูุฏ ูุญุชูู ููุท ุนูู 1 ุฃู 0.


ุฅุฐุง ูุงูุช ุงููููุฉ 'MapQuest' โ ุชุตุจุญ 1ุ ุบูุฑ ุฐูู โ 0.

data['Sunrise_Sunset'] = get_binary_column(data, 'Sunrise_Sunset')

data['Civil_Twilight'] = get_binary_column(data, 'Civil_Twilight')

data['Nautical_Twilight'] = get_binary_column(data, 'Nautical_Twilight')

data['Astronomical_Twilight'] = get_binary_column(data, 'Astronomical_Twilight')


โค ูุงุฐุง ุชูุนู ูุฐู ุงูุฃุณุทุฑุ

ุชุทุจู ููุณ ุงูููุฑุฉ ุนูู 4 ุฃุนูุฏุฉ ุชุชุนูู ุจูุชุฑุงุช ุงูุฅุถุงุกุฉ ูู ุงูููู.


ุงูููู ุงูุชู ูุงูุช 'Day' ุชูุญูููู ุฅูู 1ุ ูุบูุฑูุง (ูุซู 'Night') ุชุชุญูู ุฅูู 0.

๐ง ุงูููุฑุฉ ุงูุนุงูุฉ:

| ุงูุนููุฏ                  | ุงููููุฉ ุงูุฃุตููุฉ | ุงููููุฉ ุจุนุฏ ุงูุชุญููู |
| ----------------------- | -------------- | ------------------ |
| `Source`                | MapQuest       | 1                  |
|                         | Bing, Here...  | 0                  |
| `Sunrise_Sunset`        | Day            | 1                  |
|                         | Night          | 0                  |
| `Civil_Twilight`        | Day            | 1                  |
|                         | Night          | 0                  |
| `Nautical_Twilight`     | Day            | 1                  |
|                         | Night          | 0                  |
| `Astronomical_Twilight` | Day            | 1                  |
|                         | Night          | 0                  |

๐ฏ ููุงุฐุง ููุนู ูุฐุงุ
ุงูุจูุงูุงุช ุงููุตูุฉ ูุง ุชููููุง ููุงุฐุฌ ุงูุชุนูู ุงูุขูู.

ูุฐู ุงูุฃุนูุฏุฉ ุชุญุชูู ุนูู ูููุชูู ููุท โ ูุฐูู ูููููุง ุงุณุชุฎุฏุงู ุงูุชุฑููุฒ ุงูุซูุงุฆู (Binary Encoding) ุจุฏูุงู ูู One-Hot.

ูุฌุนู ุงูุจูุงูุงุช ุฌุงูุฒุฉ ููููุงุฐุฌ ุจุฏูู ุงูุญุงุฌุฉ ุฅูู ูุนุงูุฌุงุช ุฅุถุงููุฉ.
"""

data

"""#Splitting/Scaling"""

y = data['Severity'].copy()

X = data.drop('Severity', axis=1).copy()

y.unique()

y = y - 1

X = X.astype(float)

scaler = StandardScaler()

X = scaler.fit_transform(X)

X_train, X_test, y_train, y_test = train_test_split(X, y, train_size=0.7, random_state=100)

X.shape

inputs = tf.keras.Input(shape=(X.shape[1],))
x = tf.keras.layers.Dense(64, activation='relu')(inputs)
x = tf.keras.layers.Dense(64, activation='relu')(x)
outputs = tf.keras.layers.Dense(4, activation='softmax')(x)

model = tf.keras.Model(inputs, outputs)

model.compile(
    optimizer='adam',
    loss='sparse_categorical_crossentropy',
    metrics=['accuracy']
)
batch_size = 32
epochs = 20

history = model.fit(
    X_train,
    y_train,
    validation_split=0.2,
    batch_size=batch_size,
    epochs=epochs,
    callbacks=[
        tf.keras.callbacks.ReduceLROnPlateau(),
        tf.keras.callbacks.EarlyStopping(
            monitor='val_loss',
            patience=3,
            restore_best_weights=True
        )
    ]
)

print("Test Accuracy:", model.evaluate(X_test, y_test, verbose=0)[1])

